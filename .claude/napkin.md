# Repo Harness napkin

- **CHANGELOG**: Root CHANGELOG.md follows Keep a Changelog format. Update on each release.
- **CI audit**: `pnpm audit --audit-level=high` runs after install; fails CI on high/critical vulnerabilities.
- **Harness execute bit**: Template harness has mode 100755 in git. CLI sets `chmodSync(harnessPath, 0o755)` after copy so `./harness dev` works even if extraction strips it. CI verifies `test -x packages/template/harness`.
- **CLI project name validation**: `validateProjectName()` rejects empty, path traversal (`/`, `\`, `..`), and invalid chars (leading `.`/`_`, `<>:"|?*`). Throws for testability; init action catches and exits.
- **eslint-plugin-boundaries**: v5.4.0 is used; v4.3.0 does not exist. Template uses ESLint 8 so that `next lint` and `eslint-config-next` (next/core-web-vitals) work; ESLint 9 with flat config would require a different Next/ESLint setup.
- **Tailwind v4 + PostCSS**: Template uses `@tailwindcss/postcss` (not `tailwindcss` directly); globals.css uses `@import "tailwindcss"`. CLI `program.parse()` runs only when file is main module (`resolve(import.meta.url) === resolve(cwd, argv[1])`) so unit tests can import from index.
- **Template package.json**: Uses placeholder `{{PROJECT_NAME}}`; CLI replaces it on init.
- **CLI**: Built output must have exactly one shebang (tsup banner); source file should not duplicate it or the runner sees "Invalid or unexpected token" on line 2.
- **Repro script**: Uses `tar -czf` (Unix). On Windows the script may prompt to zip manually.
- **CLI template path**: `resolveTemplatePath(__dirname)` tries npm layout (`../template` from dist/) first, then monorepo (`../../template`). Prebuild copies `packages/template` into `packages/cli/template` before publish so the published package includes the template.
- **CLI version**: Read from package.json via createRequire, not hardcoded.
- **CLI init error handling**: try/catch around file ops with best-effort `rmSync(targetDir)` cleanup on failure.
- **CLI install**: Uses `execFileSync(cmd, args)` (no shell) to avoid TypeScript overload issues and improve safety.
- **Root .gitignore**: Includes repro-*.tar.gz, repro-*.zip, repro.json so repro packs aren't committed.
- **repro.mjs**: fs.unlinkSync wrapped in try-catch (file may not exist if writeFileSync failed).
- **Tailwind template**: content paths are src/app and src/domains only (no pages/components).
- **Template engines**: package.json has `engines: { node: ">=20" }` to match README.
- **Template .env.example**: Documents env var pattern; copy to .env.local for local dev.
- **Playwright CI**: Uses `reporter: "list"` in CI for inline output.
- **Dockerfile**: Pinned to pnpm@9 (not latest).
- **replacePlaceholders**: Logs console.warn on unreadable files instead of silent skip.
- **Audit command env**: `pnpm` may be missing on PATH in this environment; use `corepack pnpm ...` for CI-like checks.
- **Security gate status**: `corepack pnpm audit --audit-level=high` passes after upgrading template Next.js to 15.5.12 (fixed critical/high advisories). One moderate (esbuild via Vitest, dev-only) remains.
- **Reproducibility note**: Template package does not include a lockfile, so first generated app install determines initial transitive versions until `pnpm-lock.yaml` is committed.
- **Step 2 audit (packaging)**: Use `pnpm pack`/`pnpm publish` for create-repo-harness; `npm pack` does not replace `workspace:*`. No RELEASING.md; publish order must be repo-harness first, then create-repo-harness.
